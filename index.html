<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        display: flex;
        justify-content: center;
        margin: 50px;
        padding: 0px;
      }

      #canvas {
        cursor: crosshair;
      }
    </style>
    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
    <script>
      function init() {
          // Music: http://www.bensound.com
          const music = new Audio("./assets/audio/slowmotion.mp3");
          // music.play();


           var canvas = document.getElementById('canvas');
           const context = canvas.getContext('2d');
           var stage = new createjs.Stage("canvas");
           canvas.style.background = 'black';


           function getMousePos(canvas, evt) {
              var rect = canvas.getBoundingClientRect();
              return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
              };
            }
            canvas.addEventListener('mousemove', function(evt) {
                let mousePos = getMousePos(canvas, evt);
                let userCircle = new createjs.Shape();
                userCircle.time = createjs.Ticker.getTime();
                userCircle.name = "userCircle";
                userCircle.graphics.beginFill("lightblue").drawCircle(0,0, 3);
                userCircle.x = mousePos.x;
                userCircle.y = mousePos.y;
                stage.addChild(userCircle);

                let tail = new createjs.Shape();
                tail.name = 'tail';
                tail.time = createjs.Ticker.getTime();
                tail.graphics.beginFill("yellow").drawCircle(0,0,1);
                tail.x = mousePos.x;
                tail.y = mousePos.y;
                stage.addChild(tail);

              console.log('Mouse position: ' + mousePos.x + ',' + mousePos.y);
            }, false);


            for ( let i = 0; i < 75; i++ ) {
              var circle = new createjs.Shape();
              var sizes = [4, 4];
              var colors = ["#DAF7A6", "#FFC300", "#FF5733", "#C70039", "#900C3F"]
              var size = sizes[Math.floor(Math.random() * sizes.length)];
              var color = colors[Math.floor(Math.random() * colors.length)];
              circle.graphics.beginFill(color).drawCircle(0,0, size);
                //along top (y0 x0-600)
                circle.x = Math.floor(Math.random() * 600);
                circle.y = Math.floor(Math.random() * 300) - 300;

              circle.name = "obstacle";
              circle.time = createjs.Ticker.getTime();
              circle.setBounds(circle.x, circle.y, 2, 2);
              stage.addChild(circle);
            }

           createjs.Ticker.addEventListener("tick", tick);

           function tick(event) {

             function getMousePos(canvas, evt) {
                var rect = canvas.getBoundingClientRect();
                return {
                  x: evt.clientX - rect.left,
                  y: evt.clientY - rect.top
                };
              }

             for (let i = 0; i<stage.children.length; i++) {
               const currentChild = stage.getChildAt(i);
               if (currentChild.name === "userCircle") {
                 if (i < stage.children.length - 2) {
                   stage.removeChild(currentChild);
                 }
               } else if (currentChild.name === 'tail') {
                 let currentTime = createjs.Ticker.getTime();
                 if (currentChild.time < currentTime - 200) {
                   stage.removeChild(currentChild);
                 }
               } else if (currentChild.name === 'obstacle') {
                 currentChild.x -= event.delta/1000*100;
                 currentChild.y += event.delta/1000*100;
                 if (currentChild.y > stage.canvas.height ) { currentChild.y = 0 }
                 if (currentChild.x < 0) { currentChild.x = stage.canvas.width; }
                 let currentTime = createjs.Ticker.getTime();
                 let elapsedTime = (currentTime - currentChild.time)/1000;

                 currentChild.x -= (event.delta/1000) - 4;
                 currentChild.y += (event.delta/1000) - 4;


                 console.log(currentChild.getBounds());

               }
             }
             stage.update();
           }
         }




    </script>
  </head>

  <body onLoad="init();">
    <canvas id="canvas" width="600" height="300">
    </canvas>
  </body>

</html>
